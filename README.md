https://github.com/Vazhdaichik95/weblarek.git
# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
# Интернет-магазин «Web-Larёk»
«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и  отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component
Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`


#### Класс Api
Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter
Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` -  хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

### Данные

#### Интерфейс IProduct

interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
}

#### Интерфейс IBuyer

interface IBuyer {
  payment: TPayment;
  email: string;
  phone: string;
  address: string;
}

### Модели данных

#### класс Catalog

Содержит в себе массив всех товаров и выбранную пользователем карточку.

Конструктор класса не принимает параметров.

Поля класса:  
`private products: Map<string, IProduct>)` -  хранит коллекцию товаров. Ключи коллекции - идентификаторы товаров, значения - товары.
`private selectedProduct: Product | null` -  хранит выбранный товар. 

Методы класса:  
`setProducts(allProducts: IProduct[])` - сохранение коллекции товаров, принимает массив товаров.  
`getProducts(): IProduct[]` - получение массива товаров.  
`getProductById(id:string): IProduct` - получение товара по id, принимает id товара.
`setSelectedProduct(product: Iproduct)` - сохранение выбранного товара, принимает товар.  
`getSelectedProduct(): IProduct` - получение выбранного массива.  


#### класс Cart

Содержит в себе массив товаров, выбранных покупателем для покупки.

Конструктор класса не принимает параметров.

Поля класса:  
`private products: Map<string, IProduct>)` -  хранит коллекцию товаров, выбранных покупателем для покупки. Ключи коллекции - идентификаторы товаров, значения - товары.

Методы класса:  
`getProducts()` - получение массива товаров.  
`addProduct(product: IProduct)` - добавление товара, принимает товар, выбранный покупателем.  
`deleteProduct(id: string)` - удаление товара, принимает id товара, который нужно удалить из корзины.
`clearCart()` - очищение корзины.  
`totalPrice(): number` - получение общей суммы заказа. 
`countProducts(): number` - получение количества товаров в корзине.
`isProductInCart(id:string):boolean` - проверка наличия товара в корзине по id, принимает id товара. 

#### класс Buyer

Содержит в себе данные о покупателе.

Расширяет интерфейс IBuyer.

Конструктор класса не принимает параметров.

Поля класса:  
`private buyerData: IBuyer` - хранит данные покупателя

Методы класса:  
`setPayment(payment: TPayment)` - сохранение вида оплаты.  
`setEmail(email: string)` - сохранение email.
`setPhone(phone: string)` - сохранение телефона.
`setAddress(address: string)` - сохранение адреса доставки.
`getPayment()` - получение вида оплаты.
`getEmail()` - получение email.
`getPhone()` - получение телефона.
`getAddress()` - получение адреса доставки.
`clearData()` - очищение данных.  
`validateData(): string` - проверка(валидация) данных

### Слой коммуникации

#### Класс DataFromApi

Является представителем коммуникационного слоя, отвечает за получение товаров каталога с сервера и отправку заказа на сервер

`constructor(protected api: IApi)` - В конструктор передается объект, соответствующий интерфейсу IApi.

Методы класса
`getAllProducts(): Promise<IProduct[]>` - получение всех товаров для главного каталога. 
`sendOrder(orderData: TOrder): Promise<TOrderResponse>` - отправка на сервер заказа покупателя.

### Представления

#### Класс HeaderView

Является представлением для шапки сайта (в частности кнопки "корзина" и счетчика товаров в корзине)

Интерфейс IHeaderData {
  counter: number;
}

Класс является наследником класса Component<IHeaderData>

Конструктор:
`constructor(nameContainer: string)` - конструктор принимает имя класса элемента, в котором находятся элементы кнопки и счетчика. 

Поля класса:  
`protected counterElement: HTMLElement` -  хранит элемент с счетчиком.
`protected cartButton: HTMLButtonElement` -  хранит элемент с кнопкой. 

Методы класса:  
`set counter(value: number)` - сохранение значения счетчика.

#### Класс CatalogView

Является представлением для каталога товаров

Интерфейс CatalogData {
  content: HTMLElement[];
}

Класс является наследником класса Component<CatalogData>

Конструктор:
`constructor(nameContainer: string)` - конструктор принимает имя класса элемента каталога. 

Поля класса:  
`container: HTMLElement` -  хранит элемент с контейнером, в который добавляются товары.

Методы класса:  
`set content(items: HTMLElement[])` - сохранение массива элементов карточек товаров.

#### Класс ModalView

Является представлением для модального окна

Интерфейс ModalData {
  content: HTMLElement;
}

Класс является наследником класса Component<ModalData>

Конструктор:
`constructor(nameContainer: string)` - конструктор принимает имя класса элемента модального окна. 

Поля класса:  
`rootContainer: HTMLElement` -  хранит элемент модального окна.
`container: HTMLElement` -  хранит элемент с контейнером, в который добавляется содержимое окна.
`closeButton: HTMLButtonElement` -  хранит элемент с кнопкой закрытия окна.

Методы класса:  
`set content(items: HTMLElement)` - сохранение содержимого модального окна.
`open(contentElement: HTMLElement)` - добавление к элементу модального окна класса "modal_active" для открытия.
`close()` - удаление у элемента модального окна класса "modal_active" для закрытия.

#### Класс CardCatalogView

Является представлением карточки товара в каталоге

Интерфейс CardCatalogData {
  id: string;
  title: string;
  price: number | null;
  category: string;
  image: string;
}

Класс является наследником класса Component<CardCatalogData>

Конструктор:
`constructor(private data: CardCatalogData)` - конструктор принимает данные о товаре. 

Поля класса:  
`element: HTMLButtonElement` -  хранит элемент карточки товара, является кнопкой.
`titleElement: HTMLElement` -  хранит элемент названия карточки.
`priceElement: HTMLElement` -  хранит элемент цены карточки.
`categoryElement: HTMLElement` -  хранит элемент категории карточки.
`imageElement: HTMLImageElement` -  хранит элемент с изображением карточки.

Методы класса:  
`render(data: CardCatalogData): HTMLButtonElement` - отрисовка карточки.
`getElement(): HTMLButtonElement` - получение элемента карточки.

#### Класс CardPreviewView

Является представлением карточки товара в модальном окне

Интерфейс CardPreviewData {
  product: IProduct;
  onCart: boolean;
}

Класс является наследником класса Component<CardPreviewData>

Конструктор класса не принимает параметров. 

Поля класса:  
`element: HTMLButtonElement` -  хранит элемент карточки товара, является кнопкой.
`titleElement: HTMLElement` -  хранит элемент названия карточки.
`descriptionElement: HTMLElement` -  хранит элемент названия карточки.
`priceElement: HTMLElement` -  хранит элемент цены карточки.
`categoryElement: HTMLElement` -  хранит элемент категории карточки.
`imageElement: HTMLImageElement` -  хранит элемент с изображением карточки.
`buttonElement: HTMLButtonElement` -  хранит элемент с изображением карточки.

Методы класса:  
`set product(productData: IProduct)` - сохранение данных товара.
`getElement(): HTMLButtonElement` - получение элемента карточки.
`private updateButton(product: IProduct, inCart: boolean)` - обновление кнопки в зависимости от того, добавлена карточка в корзину или нет.

#### Класс CartView

Является представлением корзины

Интерфейс CartData {
  content: HTMLElement[];
  totalPrice: number;
}

Класс является наследником класса Component<CartData>

Конструктор класса не принимает параметров.

Поля класса:  
`element: HTMLButtonElement` -  хранит элемент корзины.
`listElement: HTMLElement` -  хранит элемент списка, в который добавляются карточки товара.
`totalElement: HTMLElement` -  хранит элемент с итоговой стоимостью.
`orderButton: HTMLButtonElement` -  хранит элемент с кнопкой "Офрмить заказ".

Методы класса:  
`set totalPrice(total: number)` - сохранение общей стоимости.
`set content(items: HTMLElement[])` - сохранение списка элементов с карточками тооваров.
`getElement(): HTMLButtonElement` - получение элемента корзины.

#### Класс CardInCartView

Является представлением карточки товара в каталоге

Интерфейс CardInCartData {
  id: string;
  title: string;
  price: number;
}

Класс является наследником класса Component<CardInCartData>

Конструктор:
`constructor(cardData: CardInCartData, index: number)` - конструктор принимает данные о товаре и порядковый номер в корзине. 

Поля класса:  
`container: HTMLElement` -  хранит элемент карточки товара.
`titleElement: HTMLElement` -  хранит элемент названия карточки.
`priceElement: HTMLElement` -  хранит элемент цены карточки.
`indexCardElement: HTMLElement` -  хранит элемент порядкового номера карточки в корзине.
`deleteFromCartButton: HTMLButtonElement` -  хранит элемент с кнопкой удаления карточки из корзины.

Методы класса:  
`set id(idData: string)` - сохранение id карточки.
`set title(titleData: string)` - сохранение названия карточки.
`set price(priceData: number)` - сохранение цены карточки.
`getElement(): HTMLElement` - получение элемента карточки.

#### Класс OrderFormView

Является представлением первой части формы для оформления заказа

Конструктор:
`constructor(initial?: Partial<IBuyer>)` - конструктор принимает данные о покупателе. 

Поля класса:  
`element: HTMLFormElement` -  хранит элемент формы.
`btnCard: HTMLButtonElement` -  хранит элемент кнопки выбора способа оплаты.
`btnCash: HTMLButtonElement` -  хранит элемент кнопки выбора способы оплаты.
`addressInput: HTMLInputElement` -  хранит элемент текстового поля для указания адреса.
`submitBtn: HTMLButtonElement` -  хранит элемент с кнопкой продолжения оформления заказа.
`errorEl: HTMLElement` -  хранит элемент указанием возможных ошибок валидации.

Методы класса:  
`private setPayment(payment: Payment)` - сохранение способа оплаты.
`validate(): string[]` - валидация формы.
`getElement(): HTMLElement` - получение элемента карточки.

#### Класс ContactsFormView

Является представлением второй части формы для оформления заказа

Конструктор:
`constructor(initial?: Partial<IBuyer>)` - конструктор принимает данные о покупателе. 

Поля класса:  
`element: HTMLFormElement` -  хранит элемент формы.
`emailInput: HTMLInputElement` -  хранит элемент текстового поля для указания email.
`phoneInput: HTMLInputElement` -  хранит элемент текстового поля для указания телефона.
`submitBtn: HTMLButtonElement` -  хранит элемент с кнопкой оформления заказа.
`errorEl: HTMLElement` -  хранит элемент указанием возможных ошибок валидации.

Методы класса:  
`validate(): string[]` - валидация формы.
`getElement(): HTMLElement` - получение элемента карточки.

#### Класс SuccessView

Является представлением сообщения об успешной отправке заказа

Интерфейс SuccessData {
  total: number;
}

Класс является наследником класса Component<CardInCartData>

Конструктор класса не принимает параметров.

Поля класса:  
`element: HTMLFormElement` -  хранит элемент формы.
`descriptionEl: HTMLElement` -  хранит элемент для указания итоговой стоимости заказа.
`closeButton: HTMLButtonElement` -  хранит элемент кнопки для закрытия окна.

Методы класса:  
`set total(value: number)` - сохранение итоговой стоимости заказа.
`getElement(): HTMLElement` - получение элемента карточки.

### Презентер

#### Класс PresenterApp

Является презентером приложения

Конструктор класса не принимает параметров.

Обрабатываемые события:
`card:select` - открытие и отрисовка карточки товара при выборе карточки в каталоге.
`cart:add` - добавление карточки в корзину.
`cart:remove-by-id` - удаление карточки из корзины (в модальном окне "карточка товара").
`basket:open` - Открытие корзины.
`cart:remove` - удаление карточки из корзины (в модальном окне "корзина").
`cart:order` - начало оформления заказа.
`order:next` - переход ко второй части оформления заказа.
`order:confirm` - конец оформления заказа и отправка данных на сервер.
`success:close` - закрытие модального окна после оформления заказа.

Методы:
`init()` - инициализация приложения.
`loadCatalog()` - загрузка каталога.
`initEvents()` - инициализация событий.
`updateCart()` - обновление корзины.